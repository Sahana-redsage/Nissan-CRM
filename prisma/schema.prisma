generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Telecaller {
  id            Int      @id @default(autoincrement())
  username      String   @unique
  email         String   @unique
  passwordHash  String   @map("password_hash")
  fullName      String   @map("full_name")
  phone         String?
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  serviceDocuments ServiceDocument[]
  serviceInsights  ServiceInsight[]
  callLogs         CallLog[]

  @@map("telecallers")
}

model Customer {
  id                 Int       @id @default(autoincrement())
  customerName       String    @map("customer_name")
  email              String?
  phone              String
  alternatePhone     String?   @map("alternate_phone")
  address            String?
  city               String?
  state              String?
  pincode            String?
  vehicleNumber      String    @unique @map("vehicle_number")
  vehicleMake        String    @map("vehicle_make")
  vehicleModel       String    @map("vehicle_model")
  vehicleYear        Int?      @map("vehicle_year")
  purchaseDate       DateTime? @map("purchase_date") @db.Date
  lastServiceDate    DateTime? @map("last_service_date") @db.Date
  nextServiceDueDate DateTime  @map("next_service_due_date") @db.Date
  totalMileage       Int       @default(0) @map("total_mileage")
  createdAt          DateTime  @default(now()) @map("created_at")
  updatedAt          DateTime  @updatedAt @map("updated_at")

  serviceDocuments ServiceDocument[]
  serviceInsights  ServiceInsight[]
  callLogs         CallLog[]

  @@index([nextServiceDueDate])
  @@index([vehicleNumber])
  @@map("customers")
}

model ServiceDocument {
  id           Int      @id @default(autoincrement())
  customerId   Int      @map("customer_id")
  uploadedBy   Int      @map("uploaded_by")
  documentName String   @map("document_name")
  documentPath String   @map("document_path")
  documentType String   @default("service_history") @map("document_type")
  fileSize     Int?     @map("file_size")
  uploadedAt   DateTime @default(now()) @map("uploaded_at")

  customer   Customer   @relation(fields: [customerId], references: [id], onDelete: Cascade)
  telecaller Telecaller @relation(fields: [uploadedBy], references: [id])

  @@index([customerId])
  @@map("service_documents")
}

model ServiceInsight {
  id              Int      @id @default(autoincrement())
  customerId      Int      @map("customer_id")
  generatedBy     Int      @map("generated_by")
  insightsJson    Json     @map("insights_json")
  rawLlmResponse  String?  @map("raw_llm_response")
  documentIds     Int[]    @map("document_ids")
  generatedAt     DateTime @default(now()) @map("generated_at")

  customer   Customer   @relation(fields: [customerId], references: [id], onDelete: Cascade)
  telecaller Telecaller @relation(fields: [generatedBy], references: [id])

  @@index([customerId])
  @@map("service_insights")
}

model CallLog {
  id                 Int       @id @default(autoincrement())
  customerId         Int       @map("customer_id")
  telecallerId       Int       @map("telecaller_id")
  callDate           DateTime  @default(now()) @map("call_date")
  callStatus         String    @map("call_status")
  callDuration       Int?      @map("call_duration")
  notes              String?
  followUpRequired   Boolean   @default(false) @map("follow_up_required")
  followUpDate       DateTime? @map("follow_up_date") @db.Date
  serviceBooked      Boolean   @default(false) @map("service_booked")
  bookingDate        DateTime? @map("booking_date") @db.Date

  customer   Customer   @relation(fields: [customerId], references: [id], onDelete: Cascade)
  telecaller Telecaller @relation(fields: [telecallerId], references: [id])

  @@index([customerId])
  @@index([telecallerId])
  @@map("call_logs")
}
